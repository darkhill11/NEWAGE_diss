---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*. 

```{r}
library(tidyverse)
library(readxl)
library(extrafont)
library(showtext)

loadfonts(device = "win")
```

```{r}
sel_reg <-  c("DEU",
              "FRA",
              "ITA",
              "POL",
              "UKI",
              "ESP",
              "BNL",
              "EUN",
              "EUS")

```

```{r}
sel_sec <- c(
#  "oil", 
#  "gas", 
#  "COL", 
#  "CRU", 
#  "ele", 
#  "FF", 
  "energy", 
  "dwe", 
  "BUI", 
  "SER")

sel_sec2 <- c(
#  "oil", 
#  "gas", 
#  "COL", 
#  "CRU", 
  "ele", 
  "FF", 
#  "energy", 
  "dwe", 
  "BUI", 
  "hh_ser")
```
  
  
```{r}
share_cons <- read_excel("report_pivot_merged.xlsx", sheet = "abs_sector_hh_yr")

share_cons <- share_cons %>%
  spread(key = "Sector", value = "Value") %>%
  mutate(FF = oil + gas + COL + CRU) %>%
  mutate(hh_ser = FF + ele + dwe + BUI) %>%
  gather(-c("Scenario", "Year", "Region", "HH"), key = "Sector", value = "Value")
  #mutate(Fuel = str_replace(Fuel, "FF", "Fossil fuels")) %>%
  #mutate(Fuel = str_replace(Fuel, "ele", "Electricity")) %>%
  #mutate(Fuel = str_replace(Fuel, "total", "Total energy \nconsumption"))
  
  
```

```{r}
share_cons_hh_ser <- share_cons %>%
  spread(key = "Sector", value = "Value") %>%
  mutate(ele = ele/hh_ser) %>%
  mutate(FF  = FF/hh_ser) %>%
  mutate(dwe = dwe/hh_ser) %>%
  mutate(BUI = BUI/hh_ser) %>%
  gather(-c("Scenario", "Year", "Region", "HH"), key = "Sector", value = "Value") %>%
  filter(Sector %in% sel_sec2, Region %in% sel_reg, Year == 2030) %>%
  spread(key = "Scenario", value = "Value") %>%
  mutate(bau = (bau-ref)) %>%
  mutate(cAP = (cAP-ref)) %>%
  mutate(inv = (inv-ref)) %>%
  mutate(lab = (lab-ref)) %>%
  mutate(vat = (vat-ref)) %>%
  gather('bau', 'cAP', 'inv', 'vat', 'lab', "ref", key = 'Scenario', value = 'Value')
```

```{r}
share_cons_filter <- share_cons %>%
  filter(Year == 2030, Region %in% sel_reg, Sector %in% sel_sec,
         Scenario != "ref")
```

```{r}


```

```{r}
cons_sec <- ggplot(filter(share_cons_hh_ser, 
                          Scenario != "ref",
                          Sector != "hh_ser", 
                          Region == "DEU", #| Region == "DEU"#, 
                          HH %in% c("hh1", "hh3", "hh5")), 
                   aes(x = Value, y=HH))

cons_sec +
  geom_col(aes(fill = HH)) +
  facet_grid(Region + Sector~Scenario)

```

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Ctrl+Alt+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Ctrl+Shift+K* to preview the HTML file).

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.
