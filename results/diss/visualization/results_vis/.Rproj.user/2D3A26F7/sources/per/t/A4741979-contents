---
title: "tax_incidence"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
library(tidyverse)
library(readxl)
library(extrafont)
library(showtext)

loadfonts(device = "win")
```

```{r}
ra_hh_par <- read_excel("report_pivot_merged.xlsx", sheet = "RA_hh_par_yr")
cons_hh <- read_excel("report_pivot_merged.xlsx", sheet = "cons_hh_accounts")

```

```{r}
ra_hh_par_filter <- ra_hh_par %>%
  filter(Sector == "net_income", Scenario != "ref", Year == 2030)

ra_hh_par_filter <- ra_hh_par_filter[-c(2)] %>% rename(ra_hh = Value)
```

```{r}
cons_hh_filter <- cons_hh %>%
  filter(Sector == "CO2_NETSr" | Sector == "CO2_inv_pay", Scenario != "ref", Year == 2030)

cons_hh_filter <- cons_hh_filter[-c(4)] %>% 
  rename(cons_hh = Value)
```

```{r}
tax_incidence <- full_join(ra_hh_par_filter, cons_hh_filter, by=c("Region", "Scenario", "Year", "HH"))

tax_incidence <- tax_incidence %>% mutate(incidence = cons_hh/ra_hh)

```

```{r}
incidence_plot <- ggplot(tax_incidence, aes(x=HH, y=incidence, color = Region, group = Region))

incidence_plot +
  geom_point() +
  geom_line()+
  facet_wrap(~Scenario, ncol = 3)
```