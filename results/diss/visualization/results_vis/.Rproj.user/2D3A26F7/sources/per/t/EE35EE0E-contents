---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*. 

```{r}
library(tidyverse)
library(readxl)
library(extrafont)
library(showtext)

#font_import()

loadfonts(device = "win")
```

```{r}
ets_prices <-  read_excel("report_pivot_merged.xlsx", sheet = "pco2_ets_yr")
netsr_prices <- read_excel("report_pivot_merged.xlsx", sheet = "pco2_netsr_yr")
```

```{r}
ets_prices$Region = "EU28"
ets_prices <- ets_prices[, c(1,4,2,3)]
```

```{r}
all_prices <- rbind(ets_prices, netsr_prices)
```

```{r}
all_prices_filter <- all_prices %>%
  filter(Year == 2030) %>%
  subset(Region %in% c("EU28",
                       "DEU",
                       "FRA",
                       "ITA",
                       "POL",
                       "UKI",
                       "ESP",
                       "BNL",
                       "EUN",
              
                                "EUS"))

all_prices_filter[[1]] = toupper(all_prices_filter[[1]])


```

```{r}
ref_prices <- filter(all_prices_filter, Scenario == "REF" & Region == "EU28")

all_prices_filter <- filter(all_prices_filter, Scenario != "REF")

all_prices_filter <- rbind(all_prices_filter, ref_prices)

#all_prices_filter <- all_prices_filter %>%
  #arrange(Region) %>%
  #arrange(Scenario) %>%
  #mutate(Scenario =factor(Scenario, 
  #                        levels = c(
  #                          "REF",
  #                          "BAU",
  #                          "VAT",
  #                         "LAB",
  #                         "CAP",
  #                          "INV")))

```

```{r}
all_prices_filter_1 <- all_prices_filter


all_prices_filter_1$Region <- gsub("EU28","ETS", all_prices_filter_1$Region)
all_prices_filter_1$Region <- gsub("DEU","Germany", all_prices_filter_1$Region)
all_prices_filter_1$Region <- gsub("FRA","France", all_prices_filter_1$Region)
all_prices_filter_1$Region <- gsub("ITA","Italy", all_prices_filter_1$Region)
all_prices_filter_1$Region <- gsub("UKI","UK", all_prices_filter_1$Region)
all_prices_filter_1$Region <- gsub("POL","Poland", all_prices_filter_1$Region)
all_prices_filter_1$Region <- gsub("ESP","Spain and \nPortugal", all_prices_filter_1$Region)
all_prices_filter_1$Region <- gsub("BNL","Benelux", all_prices_filter_1$Region)
all_prices_filter_1$Region <- gsub("EUN","Northern EU", all_prices_filter_1$Region)
all_prices_filter_1$Region <- gsub("EUS","Central and \nSoutheastern EU", all_prices_filter_1$Region)
  
  
all_prices_filter_1$Region <- ordered(all_prices_filter_1$Region, levels = c("ETS",
                            "Germany",
                            "France",
                            "Italy",
                            "UK",
                            "Poland",
                            "Spain and \nPortugal",
                            "Benelux",
                            "Northern EU",
                            "Central and \nSoutheastern EU"))

all_prices_filter_1$Scenario <- ordered(all_prices_filter_1$Scenario, levels = c("REF",
                            "BAU",
                            "VAT",
                            "LAB",
                            "CAP",
                            "INV"))

```

```{r}
plot_price <-ggplot(all_prices_filter_1, aes(x=Scenario, y = Value))

plot_price +
  #geom_boxplot(data = filter(all_prices_filter_1, Region != "EU28"))+
  geom_jitter(data = all_prices_filter_1, aes(color = Region), size = 4, alpha=1, width = 0.2) +
  scale_y_continuous(name = "Price of t.eqCO2 [â‚¬ 2011]",
                     breaks = seq(0, 600,100)) +
  scale_color_brewer(palette="Paired", name = "CO2-Price") +
  theme_bw() +
  theme(text         = element_text(size=10, family="Palatino Linotype"),
        axis.text.x = element_text(size = 10),
        axis.text.y = element_text(size = 10),
        axis.title = element_text(size = 12),
        strip.text = element_text(size = 12),
        legend.text = element_text(size = 12),
        legend.title = element_text(size = 12),
        legend.position = "bottom")

ggsave(width = 7, height = 4, filename = "co2_prices.png")
```
```{r}

```
Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Ctrl+Alt+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Ctrl+Shift+K* to preview the HTML file).

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.
